"use strict";(self.webpackChunktiny=self.webpackChunktiny||[]).push([[76],{3577:(n,e,i)=>{i.r(e),i.d(e,{assets:()=>r,contentTitle:()=>c,default:()=>h,frontMatter:()=>l,metadata:()=>t,toc:()=>d});const t=JSON.parse('{"id":"cln","title":"Cln","description":"- In this section we install and sync lightningd (aka Core Lightning, aka CLN) on our NixOS box!","source":"@site/docs/cln.md","sourceDirName":".","slug":"/cln","permalink":"/nixos-mutinynet-tutorial/cln","draft":false,"unlisted":false,"tags":[],"version":"current","sidebarPosition":4,"frontMatter":{"title":"Cln","sidebar_position":4},"sidebar":"tutorialSidebar","previous":{"title":"Bitcoind","permalink":"/nixos-mutinynet-tutorial/bitcoind"},"next":{"title":"Chans Invoices","permalink":"/nixos-mutinynet-tutorial/chans-invoices"}}');var s=i(4848),o=i(8453);const l={title:"Cln",sidebar_position:4},c="CLN",r={},d=[];function a(n){const e={a:"a",code:"code",h1:"h1",header:"header",input:"input",li:"li",p:"p",pre:"pre",ul:"ul",...(0,o.R)(),...n.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(e.header,{children:(0,s.jsx)(e.h1,{id:"cln",children:"CLN"})}),"\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsxs)(e.li,{children:["In this section we install and sync ",(0,s.jsx)(e.code,{children:"lightningd"})," (aka ",(0,s.jsx)(e.a,{href:"https://github.com/ElementsProject/lightning",children:"Core Lightning"}),", aka CLN) on our NixOS box!"]}),"\n",(0,s.jsxs)(e.li,{children:["This will build and install ",(0,s.jsx)(e.code,{children:"lightningd"})," v23.05.2 via the ",(0,s.jsx)(e.code,{children:"nix-bitcoin"})," ",(0,s.jsx)(e.code,{children:"bitcoind"})," NixOS module, using a Nix flake."]}),"\n",(0,s.jsxs)(e.li,{children:["It will also configure ",(0,s.jsx)(e.code,{children:"lightningd"})," as a system service and sync it with your mutinynet bitcoind node. You should wait until bitcoind is finished syncing before starting CLN, otherwise it might take a while to sync. If you accidentally do this, there are steps below to speed things up."]}),"\n",(0,s.jsxs)(e.li,{children:["Shoutout to the ",(0,s.jsx)(e.code,{children:"nix-bitcoin"})," team for maintaining this software for anyone to use!"]}),"\n"]}),"\n",(0,s.jsx)(e.h1,{id:"exercise-add-signet-lightningd-nix-bitcoin-module-to-your-system-config",children:"Exercise: Add signet lightningd nix-bitcoin module to your system config"}),"\n",(0,s.jsx)(e.p,{children:"While our bitcoin node is syncing to mutinynet, let's add a mutinynet CLN node!"}),"\n",(0,s.jsxs)(e.p,{children:["Add this after ",(0,s.jsx)(e.code,{children:"nix-bitcoin.operator.name"})," in ",(0,s.jsx)(e.code,{children:"/etc/nixos/configuration.nix"})," (make sure to edit the file with ",(0,s.jsx)(e.code,{children:"sudo"}),")"]}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-nix",children:"  services.clightning = {\n    enable = true;\n    address = \"0.0.0.0\";\n    plugins.summary.enable = true;\n\n    # enable some cool CLN features\n    extraConfig = ''\n      experimental-offers\n      experimental-dual-fund\n      experimental-splicing\n    '';\n  };\n"})}),"\n",(0,s.jsxs)(e.p,{children:["Make sure to add your user to the ",(0,s.jsx)(e.code,{children:"clightning"})," group:"]}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-nix",children:'extraGroups = [ "wheel" "bitcoin" "clightning" ];\n'})}),"\n",(0,s.jsx)(e.p,{children:"Finally, open port 9735 to your firewall so othernodes can connect to you:"}),"\n",(0,s.jsx)(e.p,{children:"Change this line:"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-nix",children:"networking.firewall.allowedTCPPorts = [ 8333 ];\n"})}),"\n",(0,s.jsx)(e.p,{children:"to look like:"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-nix",children:"networking.firewall.allowedTCPPorts = [ 8333 9735 ];\n"})}),"\n",(0,s.jsx)(e.p,{children:"switch again!"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{children:"sudo nixos-rebuild switch --flake /etc/nixos/#btcpp-berlin-mutinynet\n"})}),"\n",(0,s.jsx)(e.p,{children:"Now logout and log back in to reflect the new user changes."}),"\n",(0,s.jsx)(e.p,{children:"Once back in, check your lightning node:"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{children:"lightning-cli getinfo\n"})}),"\n",(0,s.jsx)(e.p,{children:"If you started your lightning node before your bitcoin node was done syncing, this can result in a slow CLN initial sync. If this happens, you may want to just nuke it and start over, (once bitcoind is finished syncing):"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{children:"sudo rm -rf /var/lib/clightning/signet/ && sudo systemctl restart clightning\n"})}),"\n",(0,s.jsx)(e.p,{children:"This should allow CLN to sync instantly."}),"\n",(0,s.jsx)(e.p,{children:"Obviously don't do this if you already have money and channels on your node, as these will be lost. Of course, this is just signet, so the money isn't real anyway."}),"\n",(0,s.jsx)(e.p,{children:"Now open some channels and send some sats!"}),"\n",(0,s.jsxs)(e.ul,{className:"contains-task-list",children:["\n",(0,s.jsxs)(e.li,{className:"task-list-item",children:[(0,s.jsx)(e.input,{type:"checkbox",disabled:!0})," ","Create flake"]}),"\n",(0,s.jsxs)(e.li,{className:"task-list-item",children:[(0,s.jsx)(e.input,{type:"checkbox",disabled:!0})," ","Add bitcoind to system config"]}),"\n",(0,s.jsxs)(e.li,{className:"task-list-item",children:[(0,s.jsx)(e.input,{type:"checkbox",disabled:!0})," ","Add ",(0,s.jsx)(e.code,{children:"nix-bitcoin"})," ",(0,s.jsx)(e.code,{children:"operator"})," and ",(0,s.jsx)(e.code,{children:"generate-secrets"})," to config"]}),"\n",(0,s.jsxs)(e.li,{className:"task-list-item",children:[(0,s.jsx)(e.input,{type:"checkbox",disabled:!0})," ","Switch to the new config"]}),"\n",(0,s.jsxs)(e.li,{className:"task-list-item",children:[(0,s.jsx)(e.input,{type:"checkbox",disabled:!0})," ","Log out and log back in to update your user's groups"]}),"\n",(0,s.jsxs)(e.li,{className:"task-list-item",children:[(0,s.jsx)(e.input,{type:"checkbox",disabled:!0})," ","Test new bitcoind by running ",(0,s.jsx)(e.code,{children:"bitcoin-cli -getinfo"})]}),"\n"]})]})}function h(n={}){const{wrapper:e}={...(0,o.R)(),...n.components};return e?(0,s.jsx)(e,{...n,children:(0,s.jsx)(a,{...n})}):a(n)}},8453:(n,e,i)=>{i.d(e,{R:()=>l,x:()=>c});var t=i(6540);const s={},o=t.createContext(s);function l(n){const e=t.useContext(o);return t.useMemo((function(){return"function"==typeof n?n(e):{...e,...n}}),[e,n])}function c(n){let e;return e=n.disableParentContext?"function"==typeof n.components?n.components(s):n.components||s:l(n.components),t.createElement(o.Provider,{value:e},n.children)}}}]);